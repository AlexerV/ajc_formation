000100 IDENTIFICATION DIVISION.
000200 PROGRAM-ID. TP06P3.
000300
000400 ENVIRONMENT DIVISION.
000500 CONFIGURATION SECTION.
000600 SPECIAL-NAMES.
000700     DECIMAL-POINT IS COMMA.
000800
000900 INPUT-OUTPUT SECTION.
001000 FILE-CONTROL.
001100     SELECT EMP  ASSIGN TO SERVICES
001200     ORGANIZATION IS SEQUENTIAL.
001400
001500 DATA DIVISION.
001600 FILE SECTION.
001700 FD EMP.
001800 01 ENR-EMP.
001900     05 CODE-EMP     PIC     X(5).
002000     05 NOM-EMP      PIC     X(15).
002100     05 PREN-EMP     PIC     X(15).
002200     05 SERV-EMP     PIC     X(15).
002300     05 FCT-EMP      PIC     X(10).
002400     05 SALAIRE-EMP  PIC     9(5)V99.
002500     05 FILLER       PIC     X(3).
002600
002700 WORKING-STORAGE SECTION.
002900 77 WS-ANO       PIC 99.
003000 77 FF-EMP       PIC 9 VALUE ZERO.
003010
003100 77 VALSERV      PIC X(15).
003110 77 VALFCT       PIC X(10).
003200
003300 77 NB-EMP-FCT      PIC 99        VALUE ZERO.
003400 77 CUMUL-SAL-FCT   PIC 9(8)V99   VALUE ZERO.
003410 77 NB-EMP-SERV     PIC 99        VALUE ZERO.
003420 77 CUMUL-SAL-SERV  PIC 9(8)V99   VALUE ZERO.
003500 77 NB-GNL          PIC 99        VALUE ZERO.
003600 77 CUMUL-GNL       PIC 9(8)V99   VALUE ZERO.
003700
003800 01 L-INFOS.
003900   05 FILLER PIC X(13) VALUE '* EFFECTIF : '.
004000   05 NB-ED  PIC ZZ9   BLANK WHEN ZERO.
004100   05 FILLER PIC X(20) VALUE ' * TOTAL SALAIRES : '.
004200   05 CUM-ED PIC ZZZ.ZZ9,99 BLANK WHEN ZERO.
004300   05 FILLER PIC X(2) VALUE ' *'.
004400
004500* 48 CAR.
004600 01 L-TITRE.
004700   05 FILLER PIC X(11) VALUE '*'.
004800   05 TITRE-ED PIC X(25).
004900   05 FILLER PIC X(11) VALUE ALL SPACES.
005000   05 FILLER PIC X(1) VALUE '*'.
005100
005200 01 L-ETOILE PIC X(48) VALUE ALL '*'.
005300
005400 77 WS-MESSAGE PIC X(20).
005600
005610 01 WS-DATE.
005620    05 WS-AA PIC 99.
005621    05 WS-MM PIC 99.
005622    05 WS-JJ PIC 99.
005623
005700 PROCEDURE DIVISION.
005800
005900     PERFORM OUV-EMP
006100     PERFORM LECT-EMP
006300     PERFORM AFF-DATE
006400
007600     PERFORM UNTIL FF-EMP = 1
007700
007710       PERFORM INIT-SERVICE
009300       PERFORM RUPT-SERVICE UNTIL VALSERV NOT EQUAL SERV-EMP OR
009400                           FF-EMP = 1
010010
010020       PERFORM AFF-SERVICE
010700
010800     END-PERFORM
010900
010910     PERFORM AFF-GENERAL
012400     PERFORM FERM-EMP
012500
012600     STOP RUN.
012601
012602 RUPT-SERVICE.
012603      PERFORM INIT-FONCTION
012604      PERFORM UNTIL VALFCT  NOT EQUAL FCT-EMP OR
012605                    VALSERV NOT EQUAL SERV-EMP OR
012606                       FF-EMP = 1
012607
012608           ADD SALAIRE-EMP TO CUMUL-SAL-FCT
012609           ADD 1 TO NB-EMP-FCT
012610
012611           PERFORM LECT-EMP
012612
012613       END-PERFORM
012614
012615       PERFORM AFF-FONCTION
012616       .
012617
012618 AFF-GENERAL.
012619     IF NB-GNL = ZERO  THEN
012620        DISPLAY 'AUCUN EMPLOYE'
012621     ELSE
012622       DISPLAY L-ETOILE
012623       MOVE '   TOTAL GENERAL ' TO TITRE-ED
012624       DISPLAY L-TITRE
012625       DISPLAY L-ETOILE
012626       MOVE CUMUL-GNL TO CUM-ED
012627       MOVE NB-GNL    TO NB-ED
012628       DISPLAY L-ETOILE
012629       DISPLAY L-INFOS
012630       DISPLAY L-ETOILE
012631     END-IF.
012632
012633 AFF-SERVICE.
012634       MOVE CUMUL-SAL-SERV    TO CUM-ED
012635       MOVE NB-EMP-SERV       TO NB-ED
012636       DISPLAY L-INFOS
012637       DISPLAY L-ETOILE
012638       ADD CUMUL-SAL-SERV   TO CUMUL-GNL
012639       ADD NB-EMP-SERV      TO NB-GNL
012640      .
012641
012642 AFF-FONCTION.
012643      MOVE CUMUL-SAL-FCT TO CUM-ED
012644      MOVE NB-EMP-FCT    TO NB-ED
012645      DISPLAY L-INFOS
012646
012647      ADD CUMUL-SAL-FCT TO CUMUL-SAL-SERV
012648      ADD NB-EMP-FCT    TO NB-EMP-SERV.
012649
012650 INIT-SERVICE.
012651       MOVE SERV-EMP TO VALSERV
012652       MOVE ZERO TO CUMUL-SAL-SERV
012653       MOVE ZERO TO NB-EMP-SERV
012654
012655       PERFORM L-SERVICE.
012656
012657 INIT-FONCTION.
012658     MOVE FCT-EMP TO VALFCT
012659     MOVE ZERO TO CUMUL-SAL-FCT
012660     MOVE ZERO TO NB-EMP-FCT
012661
012662     PERFORM L-FONCTION.
012665
012666 AFF-DATE.
012667     ACCEPT WS-DATE FROM DATE
012668
012669     STRING
012670         'PARIS, LE ' DELIMITED BY SIZE
012671         WS-JJ        DELIMITED BY SIZE
012672         '/'          DELIMITED BY SIZE
012673         WS-MM        DELIMITED BY SIZE
012674         '/20'        DELIMITED BY SIZE
012675         WS-AA        DELIMITED BY SIZE
012676       INTO TITRE-ED
012677     END-STRING
012678     DISPLAY L-ETOILE
012679     DISPLAY L-TITRE
012680     DISPLAY L-ETOILE.
012692
012700 L-FONCTION.
012900* AFFICHAGE DE LA LIGNE DE LA FONCTION
013000     DISPLAY L-ETOILE
013100     INITIALIZE L-TITRE
013110     STRING
013120         'FONCTION: ' DELIMITED BY SIZE
013130         VALFCT DELIMITED BY SPACE
013140       INTO TITRE-ED
013150     END-STRING
013160     DISPLAY L-TITRE
013170     DISPLAY L-ETOILE.
013200
013210 L-SERVICE.
013220* AFFICHAGE DE LA LIGNE DU SERVICE
013230     DISPLAY L-ETOILE
013240     INITIALIZE L-TITRE
013250     STRING
013260         'SERVICE : ' DELIMITED BY SIZE
013270         VALSERV DELIMITED BY SPACE
013280       INTO TITRE-ED
013290     END-STRING
013291     DISPLAY L-TITRE
013292     DISPLAY L-ETOILE.
013293
013300 OUV-EMP.
013400     OPEN INPUT EMP.
013900
014000 FERM-EMP.
014100     CLOSE EMP.
014600
014700 LECT-EMP.
014800*    *> AT END EQUIVAUT FS=10
014900     READ EMP AT END
015000         DISPLAY 'FIN DE FICHIER SERVICES '
015100         MOVE 1 TO FF-EMP
015200     END-READ.
015300
